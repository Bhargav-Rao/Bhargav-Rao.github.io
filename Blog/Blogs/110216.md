3D Visualization of ESRI Shapefiles in R has always been a difficult process. Not many have tried to visualize geospatial data in 3D. I have utilized [`maptools`](https://cran.r-project.org/web/packages/maptools/index.html) and [`plot3D`](https://cran.r-project.org/web/packages/plot3D/index.html) for the following visualization. 

First we use the `readShapeSpatial` function from `maptools` to read the shapefile. Remeber to point it to the `.shp` file. 

    ShapeFile <- readShapeSpatial('Test.shp')

<sub>I have used a shapefile of Atlantic Canada in my examples below</sub>

The `S4` object returned from `readShapeSpatial` contains a slot called `polygon`. This helps us get the co-ordinates to plot the different polygons. 

    Polygons <- slot(ShapeFile,"polygons")

Now for some initial variables to hold the values. 

    coordinates <- list( Latitude  = numeric(0),
                         Longitude = numeric(0),
                         PolygonID = numeric(0) ) 

`numeric(0)` creates a zero length vector in R. The `PolygonID` field is used only to identify the serial number of the Polygon. Additional fields can be introduced to hold more details. The following loop runs through all the polygons in `Polygons` and takes the required fields from them. 

    for(i in 1:length(Polygons)){
      Polygon <- Polygons[[i]]
      ID <- slot(Polygon, "ID")
      coords <- data.frame(slot(slot(Polygon,"Polygons")[[1]],"coords"))
      number.rows <- nrow(coords)
      coordinates$Longitude <- c(coordinates$Longitude, coords[,1])
      coordinates$Latitude  <- c(coordinates$Latitude , coords[,2])
      coordinates$PolygonID <- c(coordinates$PolygonID, rep(ID,number.rows))
    }

To make it a bit simpler, we can cast it as a dataframe. 

    coordinates <- as.data.frame(coordinates)

Create a dummy plot

    coordinates$z <- 0
    polygon3D(coordinates$Longitude,coordinates$Latitude,coordinates$z,col="transparent")

Finally we use `polygon3D` to draw the polygons. 

    for (i in 0:length(Polygons)-1){
        testpolygon <-  coordinates[coordinates$PolygonID == as.character(i),]    
        testpolygon$z <- 0 
        polygon3D(testpolygon$Longitude,
                  testpolygon$Latitude,
                  testpolygon$z,
                  add=TRUE)
    }


We now have our nice map. 

![](../img/img-bg4-1.png)